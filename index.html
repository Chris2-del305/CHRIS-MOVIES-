<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chris Movies</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url('https://images.unsplash.com/photo-1581905764498-4c38faea9c5b?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
  background-size: cover;
  color: white;
}
header {
  background: rgba(0,0,0,0.7);
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 { color: #22c55e; margin: 0; }
.menu { cursor: pointer; font-size: 22px; }
.dropdown {
  position: absolute;
  right: 15px;
  top: 60px;
  background: rgba(0,0,0,0.9);
  border-radius: 10px;
  display: none;
}
.dropdown button {
  display: block;
  width: 100%;
  background: none;
  color: white;
  border: none;
  padding: 10px;
  text-align: left;
}
.page { display: none; padding: 20px; background: rgba(0,0,0,0.6); border-radius: 10px; margin: 20px; }
.active { display: block; }
.movies { display: grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap: 15px; }
.movie-card { background: rgba(0,0,0,0.7); border-radius: 10px; padding: 10px; text-align: center; }
.vip { border: 2px solid gold; }
input, select { width: 100%; padding: 8px; margin-top: 10px; border-radius: 6px; border: none; }
button { margin-top: 8px; padding: 8px; border: none; border-radius: 6px; background: #22c55e; color: white; cursor: pointer; }
.switch-link { margin-top: 10px; color: #38bdf8; cursor: pointer; display: inline-block; }
.whatsapp-btn { margin-top: 15px; padding: 10px; background: #25D366; border: none; border-radius: 6px; color: white; cursor: pointer; text-align: center; display: inline-block; }
video { width: 100%; max-height: 400px; border-radius: 10px; margin-top: 10px; }
</style>
</head>
<body>
<header>
  <h1>ðŸŽ¬ Chris Movies</h1>
  <div class="menu" onclick="toggleMenu()">â‹®</div>
  <div class="dropdown" id="menu">
    <button onclick="showPage('moviesPage')">Home</button>
    <button onclick="showPage('vipPage')">VIP</button>
    <button onclick="showPage('adminPage')">Admin</button>
    <button onclick="logout()">Logout</button>
  </div>
</header>

<!-- REGISTER PAGE -->
<div id="registerPage" class="page active">
<h2>Create Account</h2>
<input type="email" id="regEmail" placeholder="Email" />
<input type="password" id="regPass" placeholder="Password" />
<button onclick="register()">Register</button>
<div class="switch-link" onclick="showPage('loginPage')">Already have an account? Login</div>
<p id="regMsg"></p>
</div>

<!-- LOGIN PAGE -->
<div id="loginPage" class="page">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email" />
<input type="password" id="loginPass" placeholder="Password" />
<button onclick="login()">Login</button>
<div class="switch-link" onclick="showPage('registerPage')">Create new account</div>
<p id="loginMsg"></p>
</div>

<!-- MOVIES PAGE -->
<div id="moviesPage" class="page">
<h2>Free Movies</h2>
<div class="movies" id="freeMovies"></div>
</div>

<!-- VIP PAGE -->
<div id="vipPage" class="page">
<h2>VIP Movies ðŸ”’</h2>
<div class="movies" id="vipMovies"></div>
<select id="vipPlan">
  <option value="weekly">Weekly VIP - 6,000 UGX</option>
  <option value="monthly">Monthly VIP - 25,000 UGX</option>
</select>
<button class="whatsapp-btn" onclick="becomeVIP()">Become VIP / Pay</button>
</div>

<!-- ADMIN PAGE -->
<div id="adminPage" class="page">
<h2>Admin Panel</h2>
<input type="password" id="adminPassword" placeholder="Admin Password" />
<input type="file" id="adminFile" accept="video/*" />
<input type="text" id="adminMovie" placeholder="Movie Name" />
<select id="adminVIP">
  <option value="true">VIP</option>
  <option value="false">Free</option>
</select>
<button onclick="adminLoginAndUpload()">Upload Movie</button>
<p id="adminMsg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
  authDomain: "chris-movies-7ba0f.firebaseapp.com",
  projectId: "chris-movies-7ba0f",
  storageBucket: "chris-movies-7ba0f.appspot.com",
  messagingSenderId: "867998448675",
  appId: "1:867998448675:web:3166effb3c6c402ee78596",
  measurementId: "G-257NKYSFTE"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = null;
const adminPass = 'admin123';

window.showPage = id => {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('menu').style.display='none';
};
window.toggleMenu = ()=>{const menu=document.getElementById('menu');menu.style.display = menu.style.display==='block'?'none':'block';};

window.register = async ()=> {
  const email=document.getElementById('regEmail').value;
  const pass=document.getElementById('regPass').value;
  const msg=document.getElementById('regMsg');
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,pass);
    currentUser = userCredential.user;
    await setDoc(doc(db,'users',currentUser.uid),{email, vip:false, vipExpiry:null});
    showPage('moviesPage');
  }catch(e){msg.textContent=e.message;}
};

window.login = async ()=> {
  const email=document.getElementById('loginEmail').value;
  const pass=document.getElementById('loginPass').value;
  const msg=document.getElementById('loginMsg');
  try{
    const userCredential = await signInWithEmailAndPassword(auth,email,pass);
    currentUser=userCredential.user;
    showPage('moviesPage');
  }catch(e){msg.textContent=e.message;}
};

window.logout = ()=>{signOut(auth);showPage('loginPage');};

onAuthStateChanged(auth,user=>{currentUser=user;if(user)showPage('moviesPage');else showPage('loginPage');});

window.becomeVIP = async ()=>{
  const plan=document.getElementById('vipPlan').value;
  const phone='256753747474';
  let text=`Hello Admin, I want to pay for ${plan} VIP plan.`;
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`,'_blank');
  alert('Send payment via WhatsApp, then admin will activate your VIP.');
};

window.adminLoginAndUpload = async ()=>{
  const pass=document.getElementById('adminPassword').value;
  const movieName=document.getElementById('adminMovie').value;
  const file=document.getElementById('adminFile').files[0];
  const vip=document.getElementById('adminVIP').value==='true';
  const msg=document.getElementById('adminMsg');
  if(pass!==adminPass) return msg.textContent='Wrong admin password';
  if(!movieName || !file) return msg.textContent='Enter movie name and choose file';
  const storageRef = ref(storage,'movies/'+file.name);
  await uploadBytes(storageRef,file);
  const url = await getDownloadURL(storageRef);
  await setDoc(doc(db,'movies',movieName),{name:movieName,url,vip});
  msg.textContent='Movie uploaded!';
  document.getElementById('adminMovie').value='';
  document.getElementById('adminFile').value='';
  loadMovies();
};

async function loadMovies(){
  const freeContainer=document.getElementById('freeMovies');
  const vipContainer=document.getElementById('vipMovies');
  freeContainer.innerHTML='';vipContainer.innerHTML='';
  const querySnapshot = await getDocs(collection(db,'movies'));
  const usersRef = doc(db,'users',currentUser.uid);
  const userSnap = await getDoc(usersRef);
  const userData = userSnap.data();
  const now = new Date();

  querySnapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const card=document.createElement('div');
    card.className='movie-card'+(data.vip?' vip':'');
    
    const vipActive = data.vip ? userData.vip && userData.vipExpiry && new Date(userData.vipExpiry) > now : true;

    if(data.vip && !vipActive){
      card.innerHTML=`<strong>${data.name}</strong><br/>VIP Only`;
      vipContainer.appendChild(card);
    } else if(data.vip){
      card.innerHTML=`<strong>${data.name}</strong><br/><video controls src='${data.url}'></video>`;
      vipContainer.appendChild(card);
    } else {
      card.innerHTML=`<strong>${data.name}</strong><br/><video controls src='${data.url}'></video>`;
      freeContainer.appendChild(card);
    }
  });
}

setTimeout(loadMovies,2000);
</script>
</body>
                                     </html>
