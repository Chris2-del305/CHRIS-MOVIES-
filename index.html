<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chris Movies</title>
<style>
body {
  margin:0;
  font-family: 'Arial', sans-serif;
  background: #141414;
  color: white;
}
header {
  position: fixed;
  top:0;
  width:100%;
  height:60px;
  background:#141414;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 20px;
  z-index:10;
  border-bottom:1px solid #333;
}
header h1 {
  color:#e50914;
  font-size:24px;
  margin:0;
}
.menu { cursor:pointer; font-size:24px; color:white; }
.dropdown {
  position:absolute;
  right:20px;
  top:60px;
  background:#222;
  border-radius:6px;
  display:none;
  min-width:150px;
  z-index:20;
}
.dropdown button {
  width:100%;
  background:none;
  border:none;
  color:white;
  padding:10px;
  text-align:left;
  cursor:pointer;
}
section, .admin-panel, .login-panel, .register-panel {
  margin-top:80px;
  padding:20px;
}
h2 { margin-bottom:10px; }
.movies-grid {
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
  gap:15px;
}
.movie-card {
  background:#222;
  border-radius:6px;
  overflow:hidden;
  cursor:pointer;
  transition: transform 0.3s;
}
.movie-card:hover { transform: scale(1.05); }
.movie-card video {
  width:100%;
  height:200px;
  object-fit:cover;
  display:block;
}
.movie-title {
  padding:5px;
  text-align:center;
  font-weight:bold;
}
.vip-label { color: gold; font-weight:bold; font-size:12px; text-align:center; }
button, select, input {
  border:none;
  border-radius:6px;
  padding:8px;
  margin-top:5px;
  width:100%;
}
button { background:#e50914; color:white; cursor:pointer; }
.whatsapp-btn { background:#25D366; margin-top:10px; color:white; cursor:pointer; }
.page { display:none; }
.active { display:block; }
.admin-panel { background:#222; padding:15px; border-radius:6px; max-width:400px; margin:20px auto; }
</style>
</head>
<body>

<header>
  <h1>Chris Movies</h1>
  <div class="menu" onclick="toggleMenu()">â‹®</div>
  <div class="dropdown" id="menu">
    <button onclick="showAdmin()">Admin Panel</button>
  </div>
</header>

<!-- LOGIN -->
<section id="loginPage" class="page active">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <div style="margin-top:10px;color:#38bdf8;cursor:pointer;" onclick="showRegister()">Create Account</div>
</section>

<!-- REGISTER -->
<section id="registerPage" class="page">
  <h2>Create Account</h2>
  <input type="email" id="regEmail" placeholder="Email">
  <input type="password" id="regPass" placeholder="Password">
  <button onclick="register()">Register</button>
  <div style="margin-top:10px;color:#38bdf8;cursor:pointer;" onclick="showLogin()">Already have account? Login</div>
</section>

<!-- MOVIES PAGE -->
<section id="moviesPage" class="page">
  <h2>Free Movies</h2>
  <div class="movies-grid" id="freeMovies"></div>

  <h2>VIP Movies ðŸ”’</h2>
  <div class="movies-grid" id="vipMovies"></div>

  <h3>Become VIP</h3>
  <select id="vipPlan">
    <option value="weekly">Weekly VIP - 6,000 UGX</option>
    <option value="monthly">Monthly VIP - 25,000 UGX</option>
  </select>
  <button class="whatsapp-btn" onclick="becomeVIP()">Pay & Activate VIP</button>
</section>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="admin-panel page">
  <h2>Admin Panel</h2>
  <input type="password" id="adminPassword" placeholder="Admin Password">
  <input type="file" id="adminFile" accept="video/*">
  <input type="text" id="adminMovie" placeholder="Movie Name">
  <select id="adminVIP">
    <option value="true">VIP</option>
    <option value="false">Free</option>
  </select>
  <button onclick="adminLoginAndUpload()">Upload Movie</button>
  <p id="adminMsg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

// <<< USE YOUR FIREBASE CONFIG HERE >>>
const firebaseConfig = {
  apiKey: "AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
  authDomain: "chris-movies-7ba0f.firebaseapp.com",
  projectId: "chris-movies-7ba0f",
  storageBucket: "chris-movies-7ba0f.appspot.com",
  messagingSenderId: "867998448675",
  appId: "1:867998448675:web:3166effb3c6c402ee78596"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = null;
const adminPass = 'admin123';

window.toggleMenu = ()=>{ 
  const menu=document.getElementById('menu'); 
  menu.style.display = menu.style.display==='block'?'none':'block';
};
window.showAdmin = ()=>{
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('adminPanel').classList.add('active');
  document.getElementById('menu').style.display='none';
};

function showLogin(){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('loginPage').classList.add('active');
}
function showRegister(){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('registerPage').classList.add('active');
}
function showMovies(){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('moviesPage').classList.add('active');
}

window.register = async ()=>{
  const email=document.getElementById('regEmail').value;
  const pass=document.getElementById('regPass').value;
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,pass);
    currentUser=userCredential.user;
    await setDoc(doc(db,'users',currentUser.uid),{email, vip:false, vipExpiry:null});
    showMovies();
    loadMovies();
  }catch(e){alert(e.message);}
};

window.login = async ()=>{
  const email=document.getElementById('loginEmail').value;
  const pass=document.getElementById('loginPass').value;
  try{
    const userCredential = await signInWithEmailAndPassword(auth,email,pass);
    currentUser=userCredential.user;
    showMovies();
    loadMovies();
  }catch(e){alert(e.message);}
};

onAuthStateChanged(auth,user=>{
  currentUser=user;
  if(user) showMovies();
  else showLogin();
});

window.becomeVIP = ()=>{
  const plan=document.getElementById('vipPlan').value;
  const phone='256753747474';
  let text=`Hello Admin, I want to pay for ${plan} VIP plan.`;
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`,'_blank');
  alert('Send payment via WhatsApp, then admin will activate your VIP.');
};

window.adminLoginAndUpload = async ()=>{
  const pass=document.getElementById('adminPassword').value;
  const movieName=document.getElementById('adminMovie').value;
  const file=document.getElementById('adminFile').files[0];
  const vip=document.getElementById('adminVIP').value==='true';
  const msg=document.getElementById('adminMsg');
  if(pass!==adminPass){ msg.textContent='Wrong password'; return; }
  if(!movieName || !file){ msg.textContent='Enter movie name and select file'; return; }
  const storageRef = ref(storage,'movies/'+file.name);
  await uploadBytes(storageRef,file);
  const url = await getDownloadURL(storageRef);
  await setDoc(doc(db,'movies',movieName),{name:movieName,url,vip});
  msg.textContent='Movie uploaded!';
  document.getElementById('adminMovie').value='';
  document.getElementById('adminFile').value='';
  loadMovies();
};

async function loadMovies(){
  if(!currentUser) return;
  const freeContainer=document.getElementById('freeMovies');
  const vipContainer=document.getElementById('vipMovies');
  freeContainer.innerHTML=''; vipContainer.innerHTML='';
  const querySnapshot = await getDocs(collection(db,'movies'));
  const userSnap = await getDoc(doc(db,'users',currentUser.uid));
  const userData = userSnap.exists()?userSnap.data():{vip:false, vipExpiry:null};
  const now = new Date();
  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const card = document.createElement('div');
    card.className='movie-card';
    const vipActive = data.vip ? userData.vip && userData.vipExpiry && new Date(userData.vipExpiry) > now : true;
    if(data.vip && !vipActive){
      card.innerHTML=`<div class="movie-title">${data.name}</div><div class="vip-label">VIP Only</div>`;
      vipContainer.appendChild(card);
    } else if(data.vip){
      card.innerHTML=`<video controls src='${data.url}'></video><div class="movie-title">${data.name}</div><div class="vip-label">VIP</div>`;
      vipContainer.appendChild(card);
    } else{
      card.innerHTML=`<video controls src='${data.url}'></video><div class="movie-title">${data.name}</div>`;
      freeContainer.appendChild(card);
    }
  });
}

setTimeout(loadMovies,2000);
</script>
</body>
</html>
