<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chris Movies</title>

<style>
body{margin:0;font-family:Arial;background:#141414;color:white}

/* HEADER */
header{
  position:fixed;top:0;width:100%;height:60px;background:#000;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 15px;z-index:1000;
}
.logo{color:#e50914;font-size:22px;font-weight:bold}
.menu{font-size:26px;cursor:pointer}

/* SEARCH */
#search{
  width:100%;padding:10px;border:none;outline:none;
  background:#222;color:white
}

/* MOVIES */
section{padding:80px 15px}
.movies-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:12px;
}
.movie-card{
  position:relative;
  border-radius:10px;
  overflow:hidden;
  background:#222;
}
.movie-card img{
  width:100%;
  height:220px;
  object-fit:cover;
}
.play{
  position:absolute;top:0;left:0;width:100%;height:100%;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.6);
  font-size:30px;
  opacity:0;
  transition:0.3s;
}
.movie-card:hover .play{opacity:1}

/* VIP LOCK */
.lock{
  position:absolute;top:8px;right:8px;
  background:red;padding:4px 6px;border-radius:6px;
  font-size:12px;
}

/* ADMIN PANEL */
#adminPanel{
  display:none;background:#111;padding:15px;margin:15px;border-radius:10px
}
input,button,select{
  width:100%;padding:10px;margin:5px 0;border:none;border-radius:6px
}
button{background:#e50914;color:white;cursor:pointer}

/* VIDEO MODAL */
#player{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:black;align-items:center;justify-content:center;z-index:2000
}
#player video{width:100%;max-height:100%}
</style>
</head>

<body>

<header>
  <div class="logo">Chris Movies</div>
  <div class="menu" onclick="toggleAdmin()">⋮</div>
</header>

<input id="search" placeholder="Search movie..." onkeyup="searchMovie()">

<section>
<div class="movies-grid" id="movies"></div>
</section>

<!-- PLAYER -->
<div id="player" onclick="closePlayer()">
  <video controls id="videoPlayer"></video>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
<h3>Upload Movie</h3>

<input type="password" id="pass" placeholder="Admin password">
<input type="text" id="name" placeholder="Movie name">
<input type="file" id="poster" accept="image/*">
<input type="file" id="file" accept="video/*">

<select id="vip">
<option value="no">Free Movie</option>
<option value="yes">VIP Movie</option>
</select>

<button onclick="uploadMovie()">Upload</button>
<p id="msg"></p>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyASC5...",
  authDomain: "chris-movies-7ba0f.firebaseapp.com",
  projectId: "chris-movies-7ba0f",
  storageBucket: "chris-movies-7ba0f.appspot.com",
  messagingSenderId: "867998448675",
  appId: "1:867998448675:web:3166effb3c6c402ee78596"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const ADMIN="admin123";

/* ADMIN TOGGLE */
window.toggleAdmin=()=>{
 adminPanel.style.display =
  adminPanel.style.display==="block"?"none":"block";
};

/* UPLOAD */
window.uploadMovie=async()=>{
 if(pass.value!==ADMIN) return alert("Wrong password");

 const video=file.files[0];
 const posterImg=poster.files[0];
 const movieName=name.value;
 const isVip=vip.value==="yes";

 if(!video||!posterImg||!movieName) return alert("Fill all");

 msg.innerText="Uploading...";

 const vRef=ref(storage,"movies/"+Date.now()+video.name);
 await uploadBytes(vRef,video);
 const videoURL=await getDownloadURL(vRef);

 const pRef=ref(storage,"posters/"+Date.now()+posterImg.name);
 await uploadBytes(pRef,posterImg);
 const posterURL=await getDownloadURL(pRef);

 await addDoc(collection(db,"movies"),{
   name:movieName,
   url:videoURL,
   poster:posterURL,
   vip:isVip
 });

 msg.innerText="✅ Uploaded!";
 loadMovies();
};

/* LOAD MOVIES */
let allMovies=[];

async function loadMovies(){
 const snap=await getDocs(collection(db,"movies"));
 movies.innerHTML="";
 allMovies=[];

 snap.forEach(doc=>{
   const m=doc.data();
   allMovies.push(m);
   drawMovie(m);
 });
}

function drawMovie(m){
 movies.innerHTML+=`
  <div class="movie-card" onclick="playMovie('${m.url}',${m.vip})">
    <img src="${m.poster}">
    ${m.vip?'<div class="lock">VIP</div>':""}
    <div class="play">▶</div>
  </div>`;
}

/* PLAY */
window.playMovie=(url,vip)=>{
 if(vip){
   alert("This is VIP movie.\nPay 6000 weekly or 25000 monthly on WhatsApp: 0753747474");
   return;
 }
 videoPlayer.src=url;
 player.style.display="flex";
};

window.closePlayer=()=>{
 player.style.display="none";
 videoPlayer.pause();
};

/* SEARCH */
window.searchMovie=()=>{
 const q=search.value.toLowerCase();
 movies.innerHTML="";
 allMovies
   .filter(m=>m.name.toLowerCase().includes(q))
   .forEach(drawMovie);
};

loadMovies();
</script>

</body>
</html>
