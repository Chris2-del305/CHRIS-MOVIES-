<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chris Movies</title>
<style>
/* RESET */
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}

/* BODY */
body{background:#141414;color:white;overflow-x:hidden;}

/* HEADER */
header{
  position:fixed;
  top:0;
  width:100%;
  height:60px;
  background:rgba(0,0,0,0.9);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 20px;
  z-index:1000;
  box-shadow:0 2px 5px rgba(0,0,0,0.5);
}
.logo{color:#e50914;font-size:24px;font-weight:bold;letter-spacing:1px;}
.menu{font-size:28px;cursor:pointer;color:white;}

/* DROPDOWN ADMIN MENU */
.dropdown{
  position:absolute;
  right:20px;
  top:60px;
  background:#222;
  border-radius:8px;
  overflow:hidden;
  display:block;
  z-index:1001;
}
.dropdown button{
  background:none;
  border:none;
  color:white;
  padding:12px 25px;
  width:100%;
  text-align:left;
  cursor:pointer;
  font-size:14px;
  transition:0.2s;
}
.dropdown button:hover{background:#333;}

/* HERO */
.hero{
  height:50vh;
  background:url("https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?q=80&w=1200") center/cover no-repeat;
  display:flex;
  align-items:flex-end;
  justify-content:flex-start;
  padding:0 40px 40px 40px;
  position:relative;
}
.hero::after{
  content:"";
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  background:linear-gradient(to top,rgba(20,20,20,1),rgba(20,20,20,0));
}
.hero h1{
  position:relative;
  font-size:40px;
  z-index:1;
  font-weight:bold;
  color:white;
}

/* SEARCH */
.top-search{
  margin-top:70px;
  padding:15px 40px;
}
.top-search input{
  width:100%;
  padding:15px 20px;
  border-radius:50px;
  border:none;
  font-size:16px;
  outline:none;
  box-shadow:0 2px 5px rgba(0,0,0,0.5);
  background:#222;
  color:white;
}

/* MOVIE SECTIONS */
section{padding:20px 40px;}
section h2{margin:15px 0;font-size:24px;font-weight:bold;}
.movies-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:15px;
}

/* MOVIE CARD */
.movie-card{
  background:#222;
  border-radius:10px;
  overflow:hidden;
  position:relative;
  cursor:pointer;
  transition:transform 0.3s, box-shadow 0.3s;
}
.movie-card:hover{
  transform:scale(1.05);
  box-shadow:0 10px 15px rgba(0,0,0,0.5);
}
.movie-card img{width:100%;height:220px;object-fit:cover;border-radius:10px;}
.vip-ball{
  position:absolute;
  top:10px;
  right:10px;
  width:28px;
  height:28px;
  background:gold;
  color:black;
  border-radius:50%;
  text-align:center;
  line-height:28px;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  box-shadow:0 0 5px gold;
}

/* FLOATING VIP BALL */
.become-vip-ball{
  position:fixed;
  bottom:25px;
  right:25px;
  width:60px;
  height:60px;
  background:gold;
  color:black;
  border-radius:50%;
  text-align:center;
  line-height:60px;
  font-weight:bold;
  font-size:18px;
  cursor:pointer;
  z-index:1001;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 15px gold;
  transition:0.3s;
}
.become-vip-ball:hover{
  transform:scale(1.1);
}

/* ADMIN PANEL */
#adminPanel{
  display:none;
  position:fixed;
  top:10%;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:450px;
  background:#111;
  border-radius:12px;
  padding:25px;
  z-index:1002;
  box-shadow:0 0 15px rgba(0,0,0,0.8);
}
#adminPanel input, #adminPanel select, #adminPanel button{
  width:100%;
  margin-bottom:15px;
  padding:12px;
  border-radius:8px;
  border:none;
}
#adminPanel button{
  background:#e50914;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

/* VIP POPUP */
#vipPopup{
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  padding:25px;
  border-radius:12px;
  z-index:1003;
  text-align:center;
  box-shadow:0 0 20px rgba(255,215,0,0.8);
}
#vipPopup a{color:#25D366;font-weight:bold;text-decoration:none;}
#vipPopup button{
  margin-top:15px;
  padding:10px 20px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#e50914;
  color:white;
  font-weight:bold;
}
</style>
</head>
<body>

<header>
  <div class="logo">Chris Movies</div>
  <div class="menu">â‹®</div>
  <div class="dropdown">
    <button onclick="toggleAdminPanel()">Admin Panel</button>
  </div>
</header>

<div class="top-search">
  <input id="searchInput" placeholder="Search movies...">
</div>

<div class="hero">
  <h1>Unlimited Movies, VIP & Free</h1>
</div>

<section>
<div class="bar">
  <input id="request" placeholder="Request a movie">
  <button class="whatsapp" onclick="requestMovie()">Request</button>
</div>

<div class="bar">
  <input id="vipCode" placeholder="Enter VIP code">
  <button onclick="unlockVIP()">Unlock VIP</button>
</div>

<h2>Free Movies</h2>
<div class="movies-grid" id="free"></div>

<h2>VIP Movies ðŸ”’</h2>
<div class="movies-grid" id="vip"></div>

<!-- Become VIP floating ball -->
<div class="become-vip-ball" onclick="openVIPPopup()">VIP</div>

<!-- VIP Info Popup -->
<div id="vipPopup">
  <h3>VIP Movie ðŸ”’</h3>
  <p>Weekly: 6,000 UGX</p>
  <p>Monthly: 25,000 UGX</p>
  <p><a href="https://wa.me/256753747474" target="_blank">Request VIP on WhatsApp</a></p>
  <button onclick="document.getElementById('vipPopup').style.display='none'">Close</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h2>Admin Upload</h2>
  <input type="password" id="pass" placeholder="Admin password">
  <input type="file" id="poster">
  <input type="file" id="file">
  <input id="name" placeholder="Movie name">
  <select id="isVip">
    <option value="false">Free</option>
    <option value="true">VIP</option>
  </select>
  <button onclick="uploadMovie()">Upload Movie</button>
  <hr>
  <h3>Generate VIP Code</h3>
  <select id="vipType">
    <option value="7">Weekly</option>
    <option value="30">Monthly</option>
  </select>
  <button onclick="createVIP()">Generate VIP Code</button>
  <p id="msg"></p>
</div>

<script type="module">
// FIREBASE IMPORTS
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey:"AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
  authDomain:"chris-movies-7ba0f.firebaseapp.com",
  projectId:"chris-movies-7ba0f",
  storageBucket:"chris-movies-7ba0f.appspot.com",
  messagingSenderId:"867998448675",
  appId:"1:867998448675:web:3166effb3c6c402ee78596"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const freeDiv=document.getElementById("free");
const vipDiv=document.getElementById("vip");

// LOAD MOVIES
async function loadMovies(){
  freeDiv.innerHTML=""; vipDiv.innerHTML="";
  const snap = await getDocs(collection(db,"movies"));
  let hasMovies=false;
  snap.forEach(async docSnap=>{
    hasMovies=true;
    const m=docSnap.data();
    const posterUrl=await getDownloadURL(ref(storage,m.poster));
    const videoUrl=await getDownloadURL(ref(storage,m.file));
    const div=document.createElement("div"); div.className="movie-card";
    div.innerHTML=`<img src="${posterUrl}">`;
    const vipData=JSON.parse(localStorage.getItem("vipData")||"{}");
    const isVipActive=vipData.expiry && new Date(vipData.expiry)>new Date();
    if(m.vip==="true" && !isVipActive){
      const vipBall=document.createElement("div"); vipBall.className="vip-ball"; vipBall.innerText="i";
      vipBall.onclick=(e)=>{ e.stopPropagation(); openVIPPopup(); };
      div.appendChild(vipBall);
      div.onclick=()=>{ openVIPPopup(); };
      vipDiv.appendChild(div);
    } else {
      div.onclick=()=>{ window.open(videoUrl,"_blank"); };
      if(m.vip==="true") vipDiv.appendChild(div); else freeDiv.appendChild(div);
    }
  });
}

// ADMIN FUNCTIONS
const ADMIN="admin123";
async function uploadMovie(){
  const pass=document.getElementById("pass").value;
  if(pass!==ADMIN){ alert("Wrong password"); return; }
  const name=document.getElementById("name").value;
  const posterFile=document.getElementById("poster").files[0];
  const movieFile=document.getElementById("file").files[0];
  const vip=document.getElementById("isVip").value;
  if(!name||!posterFile||!movieFile) return alert("Fill all fields");
  const posterRef=ref(storage,"posters/"+posterFile.name);
  const fileRef=ref(storage,"movies/"+movieFile.name);
  await uploadBytes(posterRef,posterFile);
  await uploadBytes(fileRef,movieFile);
  await addDoc(collection(db,"movies"),{title:name,poster:"posters/"+posterFile.name,file:"movies/"+movieFile.name,vip});
  alert("Movie uploaded!");
  loadMovies();
}

// VIP
async function createVIP(){
  const type=document.getElementById("vipType").value;
  const code="VIP"+Math.floor(Math.random()*100000);
  await addDoc(collection(db,"vipCodes"),{code,type});
  document.getElementById("msg").innerText="VIP code: "+code;
}
async function unlockVIP(){
  const codeInput=document.getElementById("vipCode").value;
  if(!codeInput) return alert("Enter VIP code");
  const q=query(collection(db,"vipCodes"),where("code","==",codeInput));
  const snap=await getDocs(q);
  if(snap.empty){ alert("Invalid VIP code"); return; }
  const docData=snap.docs[0].data();
  const durationDays=parseInt(docData.type);
  const expiry=new Date(); expiry.setDate(expiry.getDate()+durationDays);
  localStorage.setItem("vipData",JSON.stringify({code:codeInput,expiry:expiry.toISOString()}));
  alert("VIP unlocked until "+expiry.toLocaleString());
  loadMovies();
}

// MENU & WHATSAPP
function toggleAdminPanel(){ 
  const panel=document.getElementById("adminPanel");
  panel.style.display=panel.style.display==="block"?"none":"block"; 
}
function requestMovie(){ 
  const name=document.getElementById("request").value; 
  if(!name) return alert("Enter movie"); 
  window.open("https://wa.me/256753747474?text=Request: "+name); 
}
function openVIPPopup(){ document.getElementById("vipPopup").style.display='block'; }

// SEARCH
document.getElementById("searchInput").addEventListener("input", async ()=>{
  const q=document.getElementById("searchInput").value.toLowerCase();
  freeDiv.innerHTML=""; vipDiv.innerHTML="";
  const snap=await getDocs(collection(db,"movies"));
  let found=false;
  snap.forEach(async docSnap=>{
    const m=docSnap.data();
    if(!m.title.toLowerCase().includes(q)) return;
    found=true;
    const posterUrl=await getDownloadURL(ref(storage,m.poster));
    const videoUrl=await getDownloadURL(ref(storage,m.file));
    const div=document.createElement("div"); div.className="movie-card";
    div.innerHTML=`<img src="${posterUrl}">`;
    const vipData=JSON.parse(localStorage.getItem("vipData")||"{}");
    const isVipActive=vipData.expiry && new Date(vipData.expiry)>new Date();
    if(m.vip==="true" && !isVipActive){
      const vipBall=document.createElement("div"); vipBall.className="vip-ball"; vipBall.innerText="i";
      vipBall.onclick=(e)=>{ e.stopPropagation(); openVIPPopup(); };
      div.appendChild(vipBall);
      div.onclick=()=>{ openVIPPopup(); };
      vipDiv.appendChild(div);
    } else {
      div.onclick=()=>{ window.open(videoUrl,"_blank"); };
      if(m.vip==="true") vipDiv.appendChild(div); else freeDiv.appendChild(div);
    }
  });
  if(!found && q!==""){ 
    alert("This movie is not yet uploaded. You can request it and it will be uploaded within 24 hours."); 
  }
});

loadMovies();
</script>
</body>
  </html>
