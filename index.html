<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chris Movies</title>
<style>
body{margin:0;font-family:Arial;background:#141414;color:white}

/* HEADER */
header{
  position:fixed;
  top:0;
  width:100%;
  height:60px;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 15px;
  z-index:1000;
}

.logo{color:#e50914;font-size:22px;font-weight:bold}

/* THREE DOTS */
.menu{
  font-size:28px;
  cursor:pointer;
  padding:5px 10px;
}

/* DROPDOWN */
.dropdown{
  position:absolute;
  right:10px;
  top:60px;
  background:#222;
  border-radius:8px;
  display:block;
  overflow:hidden;
}

.dropdown button{
  background:none;
  border:none;
  color:white;
  padding:12px 20px;
  width:100%;
  text-align:left;
  cursor:pointer;
}

.dropdown button:hover{background:#333}

/* SEARCH BAR TOP */
.top-search{
  margin-top:70px;
  padding:10px;
}

.top-search input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:none;
  font-size:16px;
}

/* HERO */
.hero{
  height:45vh;
  background:url("https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?q=80&w=1200") center/cover no-repeat;
  display:flex;
  align-items:flex-end;
  padding:20px;
}

.hero h1{margin:0;font-size:32px}

/* CONTENT */
section{padding:15px}
.movies-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:12px;
}

.movie-card{
  background:#222;
  border-radius:8px;
  overflow:hidden;
  position:relative;
  cursor:pointer;
}

.movie-card img{width:100%;height:200px;object-fit:cover}
.movie-card video{width:100%}

/* VIP BALL INSIDE CARD */
.vip-ball{
  position:absolute;
  top:10px;
  right:10px;
  width:28px;
  height:28px;
  background:gold;
  color:black;
  border-radius:50%;
  text-align:center;
  line-height:28px;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  box-shadow:0 0 5px gold;
}

/* BARS */
.bar{display:flex;gap:10px;margin:15px 0}
input,select,button{padding:10px;border:none;border-radius:6px}
button{background:#e50914;color:white;cursor:pointer}
.whatsapp{background:#25D366}

/* ADMIN PANEL */
#adminPanel{
  display:none;
  background:#111;
  padding:20px;
  margin:20px;
  border-radius:10px;
}

/* TOAST MESSAGE */
#toast{
  position:fixed;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.8);
  color:white;
  padding:12px 20px;
  border-radius:25px;
  font-size:14px;
  display:none;
  z-index:1005;
  text-align:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.7);
}
</style>
</head>

<body>

<header>
  <div class="logo">Chris Movies</div>

  <!-- THREE DOTS -->
  <div class="menu">â‹®</div>

  <div class="dropdown">
    <button onclick="toggleAdminPanel()">Admin Panel</button>
  </div>
</header>

<!-- SEARCH AT TOP -->
<div class="top-search">
  <input id="searchInput" placeholder="Search movies...">
</div>

<div class="hero">
  <h1>Unlimited Movies, VIP & Free</h1>
</div>

<section>

<div class="bar">
  <input id="request" placeholder="Request a movie">
  <button class="whatsapp" onclick="requestMovie()">Request</button>
</div>

<div class="bar">
  <input id="vipCode" placeholder="Enter VIP code">
  <button onclick="unlockVIP()">Unlock VIP</button>
</div>

<h2>Free Movies</h2>
<div class="movies-grid" id="free"></div>

<h2>VIP Movies ðŸ”’</h2>
<div class="movies-grid" id="vip"></div>

</section>

<!-- TOAST -->
<div id="toast"></div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <h2>Admin Upload</h2>

  <input type="password" id="pass" placeholder="Admin password"><br><br>
  <input type="file" id="poster"><br><br>
  <input type="file" id="file"><br><br>
  <input id="name" placeholder="Movie name"><br><br>

  <select id="isVip">
    <option value="false">Free</option>
    <option value="true">VIP</option>
  </select><br><br>

  <button onclick="uploadMovie()">Upload Movie</button>

  <hr>

  <h3>Create VIP Code</h3>
  <select id="vipType">
    <option value="7">Weekly</option>
    <option value="30">Monthly</option>
  </select><br><br>

  <button onclick="createVIP()">Generate VIP Code</button>

  <p id="msg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, getDoc, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

// Firebase config
const firebaseConfig = {
  apiKey:"AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
  authDomain:"chris-movies-7ba0f.firebaseapp.com",
  projectId:"chris-movies-7ba0f",
  storageBucket:"chris-movies-7ba0f.appspot.com",
  messagingSenderId:"867998448675",
  appId:"1:867998448675:web:3166effb3c6c402ee78596"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const freeDiv=document.getElementById("free");
const vipDiv=document.getElementById("vip");

// Load movies from Firebase
async function loadMovies(){
  freeDiv.innerHTML="";
  vipDiv.innerHTML="";

  const snap = await getDocs(collection(db,"movies"));
  snap.forEach(async docSnap=>{
    const m = docSnap.data();
    const posterUrl = await getDownloadURL(ref(storage,m.poster));
    const videoUrl = await getDownloadURL(ref(storage,m.file));

    const div = document.createElement("div");
    div.className="movie-card";
    div.innerHTML = `<img src="${posterUrl}">`;

    if(m.vip==="true"){
      const vipBall=document.createElement("div");
      vipBall.className="vip-ball";
      vipBall.innerText="i";
      vipBall.onclick = (e)=>{
        e.stopPropagation();
        showToast(`VIP Movie ðŸ”’\nWeekly: 6,000 UGX | Monthly: 25,000 UGX\nRequest via WhatsApp!`);
      };
      div.appendChild(vipBall);
      vipDiv.appendChild(div);
    } else {
      div.onclick=()=>{ window.open(videoUrl,"_blank"); };
      freeDiv.appendChild(div);
    }
  });
}

loadMovies();

// Admin Panel
const ADMIN="admin123";
function toggleAdminPanel(){
  const panel=document.getElementById("adminPanel");
  panel.style.display=panel.style.display==="block"?"none":"block";
}

// Admin upload
async function uploadMovie(){
  if(document.getElementById("pass").value!==ADMIN){ return showToast("Wrong admin password"); }

  const posterFile=document.getElementById("poster").files[0];
  const videoFile=document.getElementById("file").files[0];
  const title=document.getElementById("name").value;
  const vipStatus=document.getElementById("isVip").value;

  if(!posterFile||!videoFile||!title) return showToast("Fill all fields");

  const posterRef = ref(storage, `posters/${posterFile.name}`);
  await uploadBytes(posterRef,posterFile);

  const videoRef = ref(storage, `movies/${videoFile.name}`);
  await uploadBytes(videoRef,videoFile);

  await addDoc(collection(db,"movies"),{
    title:title,
    poster:`posters/${posterFile.name}`,
    file:`movies/${videoFile.name}`,
    vip:vipStatus
  });

  showToast("Movie uploaded successfully");
  loadMovies();
}

// VIP codes
function createVIP(){
  const type=document.getElementById("vipType").value;
  const code="VIP"+Math.floor(Math.random()*90000+10000);
  addDoc(collection(db,"vipCodes"),{code:code,type:type,expiry:null});
  document.getElementById("msg").innerText=`VIP Code: ${code}`;
}

// Unlock VIP
function unlockVIP(){
  const codeInput=document.getElementById("vipCode").value.trim();
  if(!codeInput) return showToast("Enter VIP code");

  getDocs(query(collection(db,"vipCodes"),where("code","==",codeInput))).then(snap=>{
    if(snap.empty){ return showToast("Invalid VIP code"); }
    snap.forEach(docSnap=>{
      const type=docSnap.data().type;
      const expiry=new Date();
      expiry.setDate(expiry.getDate()+parseInt(type));
      localStorage.setItem("vipData",JSON.stringify({code:codeInput,expiry:expiry}));
      showToast("VIP unlocked!");
    });
  });
}

// Request movie
function requestMovie(){
  const name=document.getElementById("request").value;
  if(!name) return showToast("Enter movie name");
  window.open("https://wa.me/256753747474?text=Request: "+name);
}

// Toast
function showToast(msg){
  const toast=document.getElementById("toast");
  toast.innerText=msg;
  toast.style.display="block";
  toast.style.opacity="1";
  setTimeout(()=>{
    toast.style.transition="opacity 0.5s";
    toast.style.opacity="0";
    setTimeout(()=>{ toast.style.display="none"; toast.style.transition=""; },500);
  },3000);
}

// Search
document.getElementById("searchInput").addEventListener("input", async ()=>{
  const q=document.getElementById("searchInput").value.toLowerCase();
  if(!q) return loadMovies();

  const snap = await getDocs(collection(db,"movies"));
  let found=false;
  freeDiv.innerHTML=""; vipDiv.innerHTML="";
  snap.forEach(async docSnap=>{
    const m=docSnap.data();
    if(m.title.toLowerCase().includes(q)){
      found=true;
      const posterUrl = await getDownloadURL(ref(storage,m.poster));
      const div = document.createElement("div");
      div.className="movie-card";
      div.innerHTML=`<img src="${posterUrl}">`;
      if(m.vip==="true"){
        const vipBall=document.createElement("div");
        vipBall.className="vip-ball";
        vipBall.innerText="i";
        vipBall.onclick=(e)=>{ e.stopPropagation(); showToast("VIP Movie ðŸ”’. Request via WhatsApp!"); };
        div.appendChild(vipBall);
        vipDiv.appendChild(div);
      } else { freeDiv.appendChild(div); }
    }
  });

  if(!found){ showToast("This movie is not yet uploaded. You can request it!"); }
});
</script>
</body>
</html>
