<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chris Movies ¬∑ Stream & Watch</title>
  <style>
    /* (styles are the same as before ‚Äì condensed for brevity) */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#0b0b0b; font-family:'Inter',sans-serif; color:#f5f5f5; }
    header { position:fixed; top:0; width:100%; height:70px; background:linear-gradient(180deg,#141414 0%,rgba(20,20,20,0.9) 90%); backdrop-filter:blur(8px); display:flex; align-items:center; justify-content:space-between; padding:0 30px; z-index:1000; border-bottom:1px solid rgba(255,255,255,0.05); }
    .logo { color:#e50914; font-size:26px; font-weight:700; text-transform:uppercase; }
    .menu { font-size:32px; cursor:pointer; padding:5px 15px; color:#fff; }
    .menu:hover { color:#e50914; }
    .dropdown { position:absolute; right:20px; top:70px; background:#1f1f1f; border-radius:12px; display:none; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.5); border:1px solid #333; z-index:1001; min-width:160px; }
    .dropdown button { background:none; border:none; color:#eee; padding:14px 20px; width:100%; text-align:left; cursor:pointer; font-size:16px; }
    .dropdown button:hover { background:#2e2e2e; color:#e50914; }
    .top-search { margin-top:90px; padding:0 30px; }
    .top-search input { width:100%; max-width:600px; padding:15px 20px; border-radius:40px; border:none; background:#2a2a2a; color:white; font-size:16px; outline:none; border:1px solid #3a3a3a; display:block; margin:0 auto; }
    .hero { height:60vh; min-height:400px; background:linear-gradient(0deg,rgba(11,11,11,1) 0%,rgba(11,11,11,0.7) 100%), url('https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?q=80&w=1200') center/cover no-repeat; display:flex; align-items:flex-end; padding:0 30px 60px 30px; margin-bottom:20px; }
    .hero h1 { font-size:clamp(32px,5vw,56px); font-weight:800; max-width:800px; line-height:1.2; text-shadow:0 4px 12px rgba(0,0,0,0.7); color:#fff; }
    .hero h1 span { color:#e50914; }
    section { padding:10px 30px 30px; }
    h2 { font-size:28px; font-weight:600; margin:30px 0 20px; display:flex; align-items:center; gap:10px; }
    .movies-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(160px,1fr)); gap:20px; }
    .movie-card { background:#1e1e1e; border-radius:12px; overflow:hidden; cursor:pointer; transition:transform 0.25s ease, box-shadow 0.25s ease; box-shadow:0 5px 15px rgba(0,0,0,0.5); border:1px solid #2c2c2c; position:relative; aspect-ratio:2/3; display:flex; flex-direction:column; }
    .movie-card:hover { transform:scale(1.05); border-color:#e50914; }
    .movie-card img { width:100%; height:100%; object-fit:cover; display:block; background:#333; }
    .vip-lock { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.7); color:#ffd700; font-size:20px; padding:5px 8px; border-radius:50%; z-index:10; }
    .movie-info { padding:10px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.7); position:absolute; bottom:0; left:0; right:0; transform:translateY(100%); transition:transform 0.2s; z-index:5; }
    .movie-card:hover .movie-info { transform:translateY(0); }
    .like-btn, .comment-btn { background:none; border:none; color:white; font-size:18px; cursor:pointer; display:flex; align-items:center; gap:5px; }
    .like-btn.liked { color:#e50914; }
    #vipBall { position:fixed; bottom:20px; right:20px; width:60px; height:60px; background:radial-gradient(circle at 30% 30%, #f9e57c, #e5b800); color:black; font-weight:800; font-size:16px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 5px 15px rgba(255,215,0,0.5); border:2px solid rgba(255,255,255,0.2); z-index:100; }
    .bar { display:flex; gap:15px; margin:20px 0; flex-wrap:wrap; }
    .bar input { flex:1; min-width:200px; padding:14px 18px; border-radius:40px; border:none; background:#262626; color:white; font-size:16px; outline:none; border:1px solid #3a3a3a; }
    .bar button { padding:14px 28px; border-radius:40px; border:none; font-weight:600; font-size:16px; cursor:pointer; background:#e50914; color:white; }
    .whatsapp { background:#25D366 !important; }
    #toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(20,20,20,0.95); backdrop-filter:blur(8px); color:white; padding:14px 30px; border-radius:50px; font-size:16px; display:none; z-index:3000; border:1px solid #333; }
    .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(5px); z-index:2000; display:none; }
    .modal { position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#1a1a1a; padding:30px; border-radius:24px; box-shadow:0 25px 50px rgba(0,0,0,0.7); z-index:2100; display:none; width:340px; max-width:90%; border:1px solid #333; color:#fff; }
    .modal h3 { color:#e50914; margin-bottom:20px; }
    .modal button { width:100%; margin:8px 0; padding:14px; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; }
    .modal .btn-weekly { background:#e50914; color:white; }
    .modal .btn-monthly { background:#7209b7; color:white; }
    .modal .btn-close { background:#2a2a2a; color:#aaa; }
    .modal .close-icon { position:absolute; top:15px; right:20px; font-size:28px; background:none; border:none; color:#aaa; cursor:pointer; }
    #videoModal { width:90%; max-width:800px; background:black; padding:0; }
    #videoPlayer { width:100%; min-height:200px; background:#000; }
    #videoPlayer video, #videoPlayer iframe { width:100%; height:100%; border:none; }
    #adminPanel { width:400px; max-width:95%; max-height:80vh; overflow-y:auto; }
    #adminPanel input, #adminPanel select { width:100%; padding:12px; margin-bottom:15px; background:#262626; border:1px solid #3a3a3a; border-radius:8px; color:white; }
    #adminPanel .radio-group { display:flex; gap:20px; margin-bottom:15px; color:white; flex-wrap:wrap; }
    footer { text-align:center; padding:30px; color:#777; border-top:1px solid #222; margin-top:30px; }
  </style>
</head>
<body>

<header>
  <div class="logo">Chris Movies</div>
  <div class="menu" id="menuBtn">‚ãÆ</div>
  <div class="dropdown" id="dropdownMenu">
    <button onclick="adminLogin()">Admin Panel</button>
  </div>
</header>

<div class="top-search">
  <input id="searchInput" placeholder="Search for movies...">
</div>

<div class="hero">
  <h1>Unlimited <span>Movies</span>, VIP & Free</h1>
</div>

<section>
  <div class="bar">
    <input id="request" placeholder="Request a movie (e.g., Avengers)">
    <button class="whatsapp" onclick="requestMovie()">Request via WhatsApp</button>
  </div>
  <div class="bar">
    <input id="vipCode" placeholder="Enter VIP password">
    <button onclick="unlockVIP()">Unlock VIP</button>
  </div>

  <h2><i>üé¨</i> All Movies</h2>
  <div class="movies-grid" id="moviesGrid"></div>
  <div style="text-align:center; margin:20px;" id="demoNotice"></div>
</section>

<footer>¬© 2025 Chris Movies</footer>

<div id="toast"></div>

<!-- VIP Purchase Modal -->
<div class="modal-overlay" id="vipOverlay"></div>
<div class="modal" id="vipPurchasePanel">
  <button class="close-icon" id="closePurchasePanel">&times;</button>
  <h3>‚ú® Choose VIP Plan</h3>
  <button class="btn-weekly" id="buyWeekly">Weekly ‚Äì 6,000 UGX</button>
  <button class="btn-monthly" id="buyMonthly">Monthly ‚Äì 25,000 UGX</button>
  <button class="btn-close" id="closePurchasePanel2">Close</button>
</div>

<!-- Video Player Modal -->
<div class="modal-overlay" id="videoOverlay"></div>
<div class="modal" id="videoModal">
  <button class="close-icon" id="closeVideoModal">&times;</button>
  <div id="videoPlayer"></div>
</div>

<!-- Comment Modal -->
<div class="modal-overlay" id="commentOverlay"></div>
<div class="modal" id="commentModal">
  <button class="close-icon" id="closeCommentModal">&times;</button>
  <h3 id="commentMovieTitle">Comments</h3>
  <div class="comment-list" id="commentList"></div>
  <input type="text" id="commentInput" placeholder="Write a comment...">
  <button onclick="addComment()" id="addCommentBtn">Post Comment</button>
  <button class="btn-close" id="closeCommentModal2">Close</button>
</div>

<!-- Admin Modal -->
<div class="modal-overlay" id="adminOverlay"></div>
<div class="modal" id="adminPanel">
  <button class="close-icon" id="closeAdminPanel">&times;</button>
  <h3>üõ†Ô∏è Add Movie</h3>
  <div class="radio-group">
    <label><input type="radio" name="posterSource" value="file" checked> Upload poster</label>
    <label><input type="radio" name="posterSource" value="url"> Poster URL</label>
  </div>
  <input type="file" id="posterFile" accept="image/*">
  <input type="text" id="posterUrl" placeholder="Poster URL" style="display:none;">
  <div class="radio-group">
    <label><input type="radio" name="videoSource" value="file" checked> Upload video</label>
    <label><input type="radio" name="videoSource" value="url"> Video URL</label>
  </div>
  <input type="file" id="videoFile" accept="video/*">
  <input type="text" id="videoUrl" placeholder="Video URL (YouTube, MP4...)" style="display:none;">
  <input type="text" id="name" placeholder="Movie name">
  <select id="isVip">
    <option value="false">Free</option>
 <option value="true">VIP</option>
  </select>
  <button onclick="uploadMovie()" id="uploadBtn">Add Movie</button>
  <hr>
  <p style="color:#aaa; font-size:14px;">If uploads fail, use URL options.</p>
  <button onclick="loadDemoMovies()" style="background:#444;">Load Demo Movies</button>
</div>

<script type="module">
  // ----- FIREBASE CONFIG (update with your actual project) -----
  const firebaseConfig = {
    apiKey: "AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
    authDomain: "chris-movies-7ba0f.firebaseapp.com",
    projectId: "chris-movies-7ba0f",
    storageBucket: "chris-movies-7ba0f.appspot.com",
    messagingSenderId: "867998448675",
    appId: "1:867998448675:web:3166effb3c6c402ee78596"
  };

  let db, storage;
  let firebaseAvailable = false;
  let app;

  // Try to initialize Firebase
  try {
    import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js").then(({ initializeApp }) => {
      import("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js").then(({ getFirestore, collection, addDoc, getDocs, doc, updateDoc, arrayUnion, getDoc }) => {
        import("https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js").then(({ getStorage, ref, uploadBytes, getDownloadURL }) => {
          app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          storage = getStorage(app);
          firebaseAvailable = true;
          console.log("Firebase connected");
          loadMovies(); // attempt to load from Firestore
        }).catch(e => console.error("Storage import failed", e));
      }).catch(e => console.error("Firestore import failed", e));
    }).catch(e => {
      console.error("Firebase init failed", e);
      document.getElementById('demoNotice').innerHTML = '<p style="color:orange;">‚ö†Ô∏è Firebase unavailable ‚Äì showing demo movies. Check internet or Firebase config.</p>';
      loadDemoMovies(); // fallback to demo
    });
  } catch (e) {
    console.error("Firebase error", e);
    loadDemoMovies();
  }

  // ----- GLOBAL VARIABLES -----
  const moviesGrid = document.getElementById("moviesGrid");
  const searchInput = document.getElementById("searchInput");
  const toastDiv = document.getElementById("toast");
  let currentMovieId = null;
  let allMovies = []; // store for search

  // ----- MOCK MOVIES (for demo) -----
  const demoMovies = [
    {
      id: 'demo1',
      title: 'Duck Duck Goose (2018)',
      poster: 'https://image.tmdb.org/t/p/w500/7W7PZR3f4UjY0lYq4wzG5dW9y6W.jpg',
      video: 'https://www.youtube.com/watch?v=t-adYJsfmgM',
      vip: 'false',
      likes: 42,
      comments: ['Great for kids!', 'Love this movie']
    },
    {
      id: 'demo2',
      title: 'Chris Watts (VIP)',
      poster: 'https://m.media-amazon.com/images/M/MV5BOTY4YjI2N2MtYmU0Mi00ZmEzLWE2OTYtNzY0MTE1ZmRlN2QwXkEyXkFqcGc@._V1_.jpg',
      video: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
      vip: 'true',
      likes: 12,
      comments: ['Scary', 'True story']
    },
    {
      id: 'demo3',
      title: 'Test Free Movie',
      poster: 'https://via.placeholder.com/300x450?text=Free+Movie',
      video: 'https://www.w3schools.com/html/mov_bbb.mp4',
      vip: 'false',
      likes: 8,
      comments: []
    }
  ];

  function showToast(msg, duration = 3000) {
    toastDiv.innerText = msg;
    toastDiv.style.display = "block";
    toastDiv.style.opacity = "1";
    setTimeout(() => {
      toastDiv.style.opacity = "0";
      setTimeout(() => toastDiv.style.display = "none", 500);
    }, duration);
  }
  window.showToast = showToast;

  function isVipActive() {
    const data = localStorage.getItem("vipData");
    if (!data) return false;
    try {
      const { expiry } = JSON.parse(data);
      return new Date(expiry) > new Date();
    } catch { return false; }
  }

  // Render movies (from array)
  function renderMovies(movies) {
    moviesGrid.innerHTML = "";
    if (!movies || movies.length === 0) {
      moviesGrid.innerHTML = '<p style="grid-column:1/-1; text-align:center;">No movies found.</p>';
      return;
    }
    movies.forEach(m => {
      const card = document.createElement("div");
      card.className = "movie-card";
      const lockIcon = m.vip === "true" ? '<div class="vip-lock">üîí</div>' : '';
      card.innerHTML = `
        <img src="${m.poster}" alt="${m.title}" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'">
        ${lockIcon}
        <div class="movie-info">
          <button class="like-btn" data-id="${m.id}" data-liked="false">‚ù§Ô∏è <span>${m.likes || 0}</span></button>
          <button class="comment-btn" data-id="${m.id}">üí¨ <span>${(m.comments && m.comments.length) || 0}</span></button>
        </div>
      `;

      card.addEventListener("click", (e) => {
        if (e.target.closest('button')) return;
        if (m.vip === "true" && !isVipActive()) {
          showToast("üîí VIP movie! Tap the gold button to buy access.");
          return;
        }
        openVideoPlayer(m.video);
      });

      const likeBtn = card.querySelector('.like-btn');
      likeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!firebaseAvailable) {
          showToast("Demo: likes not saved");
          return;
        }
        toggleLike(m.id, likeBtn);
      });

      const commentBtn = card.querySelector('.comment-btn');
      commentBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        openCommentModal(m.id, m.title);
      });

      moviesGrid.appendChild(card);
    });
  }

  // Load movies from Firestore or fallback
  async function loadMovies(filter = "") {
    if (!firebaseAvailable) return loadDemoMovies();

    try {
      const querySnapshot = await getDocs(collection(db, "movies"));
      const movies = [];
      querySnapshot.forEach(doc => movies.push({ id: doc.id, ...doc.data() }));
      allMovies = movies;
      const filtered = filter ? movies.filter(m => m.title?.toLowerCase().includes(filter.toLowerCase())) : movies;
      renderMovies(filtered);
      if (filter && filtered.length === 0) showToast("No matches. Request it!");
    } catch (error) {
      console.error("Firestore load error", error);
      showToast("Firebase error ‚Äì loading demo movies");
      loadDemoMovies();
    }
  }

  window.loadDemoMovies = function() {
    allMovies = demoMovies;
    renderMovies(demoMovies);
    document.getElementById('demoNotice').innerHTML = '<p style="color:orange;">üìΩÔ∏è Demo mode ‚Äì likes/comments not saved.</p>';
  };

  // Video player (clean YouTube)
  function openVideoPlayer(videoUrl) {
    const videoModal = document.getElementById('videoModal');
    const videoOverlay = document.getElementById('videoOverlay');
    const videoPlayer = document.getElementById('videoPlayer');
    videoPlayer.innerHTML = '';

    const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
    const match = videoUrl.match(youtubeRegex);

    if (match) {
      const videoId = match[1];
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3&controls=1&disablekb=0&fs=1&playsinline=1`;
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
      iframe.allowFullscreen = true;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      iframe.style.border = "none";
      videoPlayer.appendChild(iframe);
    } else {
      const video = document.createElement('video');
      video.src = videoUrl;
      video.controls = true;
      video.autoplay = true;
      video.playsInline = true;
      video.style.width = "100%";
      video.style.height = "auto";
      video.onerror = () => showToast("‚ùå Video failed to load.");
      videoPlayer.appendChild(video);
    }

    videoModal.style.display = "block";
    videoOverlay.style.display = "block";
  }

  // Close video
  document.getElementById('closeVideoModal').addEventListener('click', () => {
    document.getElementById('videoPlayer').innerHTML = '';
    document.getElementById('videoOverlay').style.display = 'none';
    document.getElementById('videoModal').style.display = 'none';
  });
  document.getElementById('videoOverlay').addEventListener('click', () => {
    document.getElementById('videoPlayer').innerHTML = '';
    document.getElementById('videoOverlay').style.display = 'none';
    document.getElementById('videoModal').style.display = 'none';
  });

  // Like toggle (Firestore only)
  async function toggleLike(movieId, btn) {
    if (!firebaseAvailable) return;
    try {
      const movieRef = doc(db, 'movies', movieId);
      const movieSnap = await getDoc(movieRef);
      if (!movieSnap.exists()) return;
      const currentLikes = movieSnap.data().likes || 0;
      const isLiked = btn.dataset.liked === 'true';
      await updateDoc(movieRef, { likes: isLiked ? currentLikes - 1 : currentLikes + 1 });
      btn.dataset.liked = isLiked ? 'false' : 'true';
      btn.querySelector('span').textContent = isLiked ? currentLikes - 1 : currentLikes + 1;
      btn.classList.toggle('liked');
    } catch (e) {
      console.error(e);
      showToast("Like failed");
    }
  }

  // Comment modal
  async function openCommentModal(movieId, title) {
    currentMovieId = movieId;
    document.getElementById('commentMovieTitle').textContent = `Comments - ${title}`;
    let comments = [];
    if (firebaseAvailable) {
      try {
        const movieSnap = await getDoc(doc(db, 'movies', movieId));
        comments = movieSnap.data()?.comments || [];
      } catch (e) { console.error(e); }
    } else {
      // demo: find movie in allMovies
      const movie = allMovies.find(m => m.id === movieId);
      comments = movie?.comments || [];
    }
    const commentList = document.getElementById('commentList');
    commentList.innerHTML = '';
    comments.forEach(c => {
      const div = document.createElement('div');
      div.className = 'comment-item';
      div.textContent = c;
      commentList.appendChild(div);
    });
    document.getElementById('commentOverlay').style.display = 'block';
    document.getElementById('commentModal').style.display = 'block';
  }

  window.addComment = async function() {
    if (!currentMovieId) return;
    const input = document.getElementById('commentInput');
    const comment = input.value.trim();
    if (!comment) return;
    if (!firebaseAvailable) {
      showToast("Demo: comment not saved");
      return;
    }
    try {
      await updateDoc(doc(db, 'movies', currentMovieId), { comments: arrayUnion(comment) });
      input.value = '';
      openCommentModal(currentMovieId, document.getElementById('commentMovieTitle').textContent.replace('Comments - ', ''));
    } catch (e) {
      showToast("Failed to add comment");
    }
  };

  // Close comment
  const closeComment = () => {
    document.getElementById('commentOverlay').style.display = 'none';
    document.getElementById('commentModal').style.display = 'none';
  };
  document.getElementById('closeCommentModal').addEventListener('click', closeComment);
  document.getElementById('closeCommentModal2').addEventListener('click', closeComment);
  document.getElementById('commentOverlay').addEventListener('click', closeComment);

  // Admin login
  window.adminLogin = function() {
    const pwd = prompt("Admin password:");
    if (pwd === "admin123") {
      document.getElementById("adminOverlay").style.display = "block";
      document.getElementById("adminPanel").style.display = "block";
      document.getElementById("dropdownMenu").style.display = "none";
    } else showToast("Wrong password");
  };

  document.getElementById("closeAdminPanel").addEventListener("click", () => {
    document.getElementById("adminOverlay").style.display = "none";
    document.getElementById("adminPanel").style.display = "none";
  });
  document.getElementById("adminOverlay").addEventListener("click", () => {
    document.getElementById("adminOverlay").style.display = "none";
    document.getElementById("adminPanel").style.display = "none";
  });

  // Toggle inputs
  document.querySelectorAll('input[name="posterSource"]').forEach(r => {
    r.addEventListener('change', e => {
      document.getElementById('posterFile').style.display = e.target.value === 'file' ? 'block' : 'none';
      document.getElementById('posterUrl').style.display = e.target.value === 'file' ? 'none' : 'block';
    });
  });
  document.querySelectorAll('input[name="videoSource"]').forEach(r => {
    r.addEventListener('change', e => {
      document.getElementById('videoFile').style.display = e.target.value === 'file' ? 'block' : 'none';
      document.getElementById('videoUrl').style.display = e.target.value === 'file' ? 'none' : 'block';
    });
  });

  // Upload movie
  window.uploadMovie = async function() {
    if (!firebaseAvailable) {
      alert("Firebase not connected ‚Äì cannot upload. Use demo mode.");
      return;
    }
    const title = document.getElementById("name").value.trim();
    const vip = document.getElementById("isVip").value;

    const posterSource = document.querySelector('input[name="posterSource"]:checked').value;
    let posterUrl = '';
    if (posterSource === 'file') {
      const file = document.getElementById("posterFile").files[0];
      if (!file) { showToast("Select poster"); return; }
      try {
        const posterRef = ref(storage, `posters/${Date.now()}_${file.name}`);
        await uploadBytes(posterRef, file);
        posterUrl = await getDownloadURL(posterRef);
      } catch (e) { alert("Poster upload failed: " + e.message); return; }
    } else {
      posterUrl = document.getElementById("posterUrl").value.trim();
      if (!posterUrl) { showToast("Enter poster URL"); return; }
    }

    const videoSource = document.querySelector('input[name="videoSource"]:checked').value;
    let videoUrl = '';
    if (videoSource === 'file') {
      const file = document.getElementById("videoFile").files[0];
      if (!file) { showToast("Select video"); return; }
      try {
        const videoRef = ref(storage, `videos/${Date.now()}_${file.name}`);
        await uploadBytes(videoRef, file);
        videoUrl = await getDownloadURL(videoRef);
      } catch (e) { alert("Video upload failed: " + e.message); return; }
    } else {
      videoUrl = document.getElementById("videoUrl").value.trim();
      if (!videoUrl) { showToast("Enter video URL"); return; }
    }

    try {
      await addDoc(collection(db, "movies"), { title, poster: posterUrl, video: videoUrl, vip, likes: 0, comments: [] });
      showToast("‚úÖ Movie added!");
      loadMovies(searchInput.value);
      document.getElementById("name").value = "";
      document.getElementById("posterFile").value = "";
      document.getElementById("posterUrl").value = "";
      document.getElementById("videoFile").value = "";
      document.getElementById("videoUrl").value = "";
    } catch (e) { alert("Firestore error: " + e.message); }
  };

  // VIP passwords
  const WEEKLY = "WEEK2025", MONTHLY = "MONTH2025";
  window.unlockVIP = function() {
    const code = document.getElementById("vipCode").value.trim();
    if (!code) return showToast("Enter password");
    const expiry = new Date();
    if (code === WEEKLY) expiry.setDate(expiry.getDate() + 7);
    else if (code === MONTHLY) expiry.setDate(expiry.getDate() + 30);
    else return showToast("Incorrect password");
    localStorage.setItem("vipData", JSON.stringify({ code, expiry: expiry.toISOString() }));
    showToast(`VIP unlocked for ${code === WEEKLY ? '7' : '30'} days!`);
  };

  window.requestMovie = function() {
    const name = document.getElementById("request").value.trim();
    if (!name) return showToast("Enter movie name");
    window.open(`https://wa.me/256753747474?text=Request: ${encodeURIComponent(name)}`, "_blank");
  };

  // VIP purchase
  const vipBall = document.getElementById("vipBall");
  const purchasePanel = document.getElementById("vipPurchasePanel");
  const vipOverlay = document.getElementById("vipOverlay");
  const closePurchase = document.getElementById("closePurchasePanel");
  const closePurchase2 = document.getElementById("closePurchasePanel2");
  const buyWeekly = document.getElementById("buyWeekly");
  const buyMonthly = document.getElementById("buyMonthly");

  function showPurchasePanel() {
    purchasePanel.style.display = "block";
    vipOverlay.style.display = "block";
  }
  function hidePurchasePanel() {
    purchasePanel.style.display = "none";
    vipOverlay.style.display = "none";
  }

  vipBall.addEventListener("click", showPurchasePanel);
  vipOverlay.addEventListener("click", hidePurchasePanel);
  closePurchase.addEventListener("click", hidePurchasePanel);
  closePurchase2.addEventListener("click", hidePurchasePanel);

  buyWeekly.addEventListener("click", () => {
    window.open(`https://wa.me/256753747474?text=Buy%20Weekly%20VIP%206000%20UGX`, "_blank");
    hidePurchasePanel();
  });
  buyMonthly.addEventListener("click", () => {
    window.open(`https://wa.me/256753747474?text=Buy%20Monthly%20VIP%2025000%20UGX`, "_blank");
    hidePurchasePanel();
  });

  // Dropdown
  const menuBtn = document.getElementById("menuBtn");
  const dropdown = document.getElementById("dropdownMenu");
  menuBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  });
  document.addEventListener("click", (e) => {
    if (!menuBtn.contains(e.target) && !dropdown.contains(e.target)) dropdown.style.display = "none";
  });

  // Search
  let searchTimeout;
  searchInput.addEventListener("input", () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      if (allMovies.length) {
        const filtered = allMovies.filter(m => m.title?.toLowerCase().includes(searchInput.value.toLowerCase()));
        renderMovies(filtered);
      } else loadMovies(searchInput.value);
    }, 300);
  });

  // Load demo movies on start if Firebase not ready
  setTimeout(() => {
    if (!firebaseAvailable) loadDemoMovies();
  }, 2000);
</script>
</body>
             </html>
