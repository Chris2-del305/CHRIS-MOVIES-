<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chris Movies</title>
<style>
body{margin:0;font-family:Arial;background:#141414;color:white}
header{position:fixed;top:0;width:100%;height:60px;background:#000;display:flex;align-items:center;justify-content:space-between;padding:0 15px;z-index:1000;}
.logo{color:#e50914;font-size:22px;font-weight:bold}
.menu{font-size:28px;cursor:pointer;padding:5px 10px}
.dropdown{position:absolute;right:10px;top:60px;background:#222;border-radius:8px;display:none;overflow:hidden;}
.dropdown button{background:none;border:none;color:white;padding:12px 20px;width:100%;text-align:left;cursor:pointer}
.dropdown button:hover{background:#333}
.top-search{margin-top:70px;padding:10px}
.top-search input{width:100%;padding:12px;border-radius:8px;border:none;font-size:16px}
.hero{height:45vh;background:url("https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?q=80&w=1200") center/cover no-repeat;display:flex;align-items:flex-end;padding:20px}
.hero h1{margin:0;font-size:32px}
section{padding:15px}
.movies-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
.movie-card{background:#222;border-radius:8px;overflow:hidden;position:relative;cursor:pointer;transition:transform 0.3s}
.movie-card:hover{transform:scale(1.05)}
.movie-card img{width:100%;height:200px;object-fit:cover}
.vip-ball{position:absolute;top:8px;right:8px;width:25px;height:25px;background:gold;color:black;border-radius:50%;text-align:center;line-height:25px;font-weight:bold;font-size:12px;cursor:pointer;z-index:5}
#adminPanel{display:none;background:#111;padding:20px;margin:20px;border-radius:10px;position:fixed;top:10%;left:50%;transform:translateX(-50%);z-index:1000;width:90%;max-width:400px}
.bar{display:flex;gap:10px;margin:15px 0}
input,select,button{padding:10px;border:none;border-radius:6px}
button{background:#e50914;color:white;cursor:pointer}
.whatsapp{background:#25D366}
</style>
</head>
<body>

<header>
  <div class="logo">Chris Movies</div>
  <div class="menu" onclick="toggleMenu()">â‹®</div>
  <div class="dropdown" id="menu">
    <button onclick="openAdmin()">Admin Panel</button>
  </div>
</header>

<div class="top-search">
  <input id="searchInput" placeholder="Search movies...">
</div>

<div class="hero">
  <h1>Unlimited Movies, VIP & Free</h1>
</div>

<section>
<div class="bar">
  <input id="request" placeholder="Request a movie">
  <button class="whatsapp" onclick="requestMovie()">Request</button>
</div>

<div class="bar">
  <input id="vipCode" placeholder="Enter VIP code">
  <button onclick="unlockVIP()">Unlock VIP</button>
</div>

<h2>Free Movies</h2>
<div class="movies-grid" id="free"></div>

<h2>VIP Movies ðŸ”’</h2>
<div class="movies-grid" id="vip"></div>

<h3>Become VIP</h3>
<select id="vipPlan">
  <option value="weekly">Weekly VIP â€“ 6,000 UGX</option>
  <option value="monthly">Monthly VIP â€“ 25,000 UGX</option>
</select>
<button class="whatsapp" onclick="payVIP()">Pay via WhatsApp</button>
</section>

<!-- VIP Popup -->
<div id="vipPopup" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;padding:20px;border-radius:10px;z-index:1001;text-align:center;">
<h3>VIP Movie ðŸ”’</h3>
<p>Weekly: 6k</p>
<p>Monthly: 25k</p>
<p><a href="https://wa.me/256753747474" target="_blank" style="color:lime;">Request VIP on WhatsApp</a></p>
<button onclick="document.getElementById('vipPopup').style.display='none'">Close</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
<h2>Admin Upload</h2>
<input type="password" id="pass" placeholder="Admin password"><br><br>
<input type="file" id="poster"><br><br>
<input type="file" id="file"><br><br>
<input id="name" placeholder="Movie name"><br><br>
<select id="isVip">
<option value="false">Free</option>
<option value="true">VIP</option>
</select><br><br>
<button onclick="uploadMovie()">Upload Movie</button>
<hr>
<h3>Generate VIP Code</h3>
<select id="vipType">
<option value="7">Weekly</option>
<option value="30">Monthly</option>
</select><br><br>
<button onclick="createVIP()">Generate VIP Code</button>
<p id="msg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey:"AIzaSyASC5piaFqMnPbuXspM1c6_KE8A1sPLq2s",
  authDomain:"chris-movies-7ba0f.firebaseapp.com",
  projectId:"chris-movies-7ba0f",
  storageBucket:"chris-movies-7ba0f.appspot.com",
  messagingSenderId:"867998448675",
  appId:"1:867998448675:web:3166effb3c6c402ee78596"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const freeDiv = document.getElementById("free");
const vipDiv = document.getElementById("vip");

// Load movies
async function loadMovies(){
  freeDiv.innerHTML=""; vipDiv.innerHTML="";
  const snap = await getDocs(collection(db,"movies"));
  snap.forEach(async docSnap=>{
    const m = docSnap.data();
    const posterUrl = await getDownloadURL(ref(storage, m.poster));
    const videoUrl = await getDownloadURL(ref(storage, m.file));
    const div = document.createElement("div"); div.className="movie-card";
    div.innerHTML=`<img src="${posterUrl}">`;
    const vipData = JSON.parse(localStorage.getItem("vipData") || "{}");
    const isVipActive = vipData.expiry && new Date(vipData.expiry) > new Date();
    if(m.vip==="true" && !isVipActive){
      const vipBall = document.createElement("div"); vipBall.className="vip-ball"; vipBall.innerText="i";
      vipBall.onclick=(e)=>{ e.stopPropagation(); document.getElementById("vipPopup").style.display='block'; };
      div.appendChild(vipBall);
      div.onclick=()=>{ document.getElementById("vipPopup").style.display='block'; };
      vipDiv.appendChild(div);
    } else {
      div.onclick=()=>{ window.open(videoUrl,"_blank"); };
      if(m.vip==="true") vipDiv.appendChild(div); else freeDiv.appendChild(div);
    }
  });
}

// Admin upload
const ADMIN="admin123";
async function uploadMovie(){
  const pass=document.getElementById("pass").value;
  if(pass!==ADMIN){ alert("Wrong password"); return; }
  const name=document.getElementById("name").value;
  const posterFile=document.getElementById("poster").files[0];
  const movieFile=document.getElementById("file").files[0];
  const vip=document.getElementById("isVip").value;
  if(!name||!posterFile||!movieFile) return alert("Fill all fields");
  const posterRef = ref(storage,"posters/"+posterFile.name);
  const fileRef = ref(storage,"movies/"+movieFile.name);
  await uploadBytes(posterRef,posterFile);
  await uploadBytes(fileRef,movieFile);
  await addDoc(collection(db,"movies"),{title:name,poster:"posters/"+posterFile.name,file:"movies/"+movieFile.name,vip});
  alert("Movie uploaded!");
  loadMovies();
}

// Generate VIP code
async function createVIP(){
  const type = document.getElementById("vipType").value;
  const code = "VIP"+Math.floor(Math.random()*100000);
  await addDoc(collection(db,"vipCodes"),{code,type});
  document.getElementById("msg").innerText="VIP code: "+code;
}

// Unlock VIP with expiry
async function unlockVIP(){
  const codeInput = document.getElementById("vipCode").value;
  if(!codeInput) return alert("Enter VIP code");
  const q = query(collection(db,"vipCodes"),where("code","==",codeInput));
  const snap = await getDocs(q);
  if(snap.empty){ alert("Invalid VIP code"); return; }
  const docData = snap.docs[0].data();
  const durationDays = parseInt(docData.type);
  const expiry = new Date(); expiry.setDate(expiry.getDate()+durationDays);
  localStorage.setItem("vipData",JSON.stringify({code:codeInput,expiry:expiry.toISOString()}));
  alert("VIP unlocked until "+expiry.toLocaleString());
  loadMovies();
}

// Menu & WhatsApp
function toggleMenu(){ const m=document.getElementById("menu"); m.style.display = m.style.display==="block"?"none":"block"; }
function openAdmin(){ document.getElementById("adminPanel").style.display="block"; document.getElementById("menu").style.display="none"; }
function requestMovie(){ const name=document.getElementById("request").value; if(!name) return alert("Enter movie"); window.open("https://wa.me/256753747474?text=Request: "+name); }
function payVIP(){ const plan=document.getElementById("vipPlan").value; window.open("https://wa.me/256753747474?text=Hello I want VIP "+plan); }

// Search
document.getElementById("searchInput").addEventListener("input", async ()=>{
  const q=document.getElementById("searchInput").value.toLowerCase();
  freeDiv.innerHTML=""; vipDiv.innerHTML="";
  const snap=await getDocs(collection(db,"movies"));
  snap.forEach(async docSnap=>{
    const m=docSnap.data();
    if(!m.title.toLowerCase().includes(q)) return;
    const posterUrl = await getDownloadURL(ref(storage, m.poster));
    const videoUrl = await getDownloadURL(ref(storage, m.file));
    const div=document.createElement("div"); div.className="movie-card";
    div.innerHTML=`<img src="${posterUrl}">`;
    const vipData = JSON.parse(localStorage.getItem("vipData") || "{}");
    const isVipActive = vipData.expiry && new Date(vipData.expiry) > new Date();
    if(m.vip==="true" && !isVipActive){
      const vipBall=document.createElement("div"); vipBall.className="vip-ball"; vipBall.innerText="i";
      vipBall.onclick=(e)=>{ e.stopPropagation(); document.getElementById("vipPopup").style.display='block'; };
      div.appendChild(vipBall);
      div.onclick=()=>{ document.getElementById("vipPopup").style.display='block'; };
      vipDiv.appendChild(div);
    } else {
      div.onclick=()=>{ window.open(videoUrl,"_blank"); };
      if(m.vip==="true") vipDiv.appendChild(div); else freeDiv.appendChild(div);
    }
  });
});

loadMovies();
</script>
</body>
</html>
